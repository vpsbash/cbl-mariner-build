name: wireguard-go

on: 
  release:
    types: [published]
  push:
    branches: 
      - main
  schedule:
    - cron: 0 0,6,12,18 * * *

# env:

  
jobs:

  build:

    runs-on: ubuntu-20.04

    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          fetch-depth: 0

      - name: Install Prerequisites
        run: |
          wget https://golang.org/dl/go1.16.7.linux-amd64.tar.gz
          sudo tar -C /usr/local -xvzf go1.16.7.linux-amd64.tar.gz
          export PATH=$PATH:/usr/local/go/bin
          mkdir -p /tmp/gobuild/
          git clone https://git.zx2c4.com/wireguard-go
          cd wireguard-go
          export GOPATH="/tmp/gobuild/"
          go build -v -o "wireguard-go"
          mkdir bin
          cp wireguard-go bin/
          
      - name: Upload artifact
        uses: actions/upload-artifact@master
        with:
          name: wireguard-go
          path: wireguard-go/bin/
